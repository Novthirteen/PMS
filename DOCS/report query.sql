select ul.user_login_id, ul.name, proj.proj_id, proj.proj_name, proj.total_service_value, proj.total_lics_value ,sum(case when c.AmtType = 'Cost' then c.CurrAmt else 0 end) as CurrCost, sum(case when c.AmtType = 'Cost' then c.LastAmt else 0 end) as LastCost ,sum(case when c.AmtType = 'CTC' then c.CurrAmt else 0 end) as CurrCTC, sum(case when c.AmtType = 'CTC' then c.LastAmt else 0 end) as LastCTC from proj_mstr as proj inner join user_login as ul on proj.proj_pm_user = ul.user_login_id right join ( select tsd.ts_proj_id as proj_id, 'Cost' as AmtType, sum(tsd.ts_hrs_user * tsd.ts_user_rate) as CurrAmt, sum(case when tsd.ts_date <= '2005-01-30' then tsd.ts_hrs_user * tsd.ts_user_rate else 0 end) as LastAmt from proj_ts_det as tsd inner join proj_mstr as proj on tsd.ts_proj_id = proj.proj_id inner join user_login as ul on proj.proj_pm_user = ul.user_login_id where ul.user_login_id ='CN01092' and tsd.ts_status = 'Approved' and tsd.ts_date <= '2005-02-06' group by tsd.ts_proj_id union select em.em_proj_id as proj_id, 'Cost' as AmtType, sum(ea.ea_amt_user * em.em_Curr_Rate) as CurrAmt sum(case when em.em_approval_date <= '2005-01-30' then ea.ea_amt_user * em.em_Curr_Rate else 0 end) as LastAmt from Proj_Exp_Amt as ea inner join proj_exp_mstr as em on ea.em_id = em.em_id  inner join proj_mstr as proj on em.em_proj_id = proj.proj_id inner join user_login as ul on proj.proj_pm_user = ul.user_login_id where ul.user_login_id ='CN01092' and em.em_status='Approved' and em.em_claimtype='CN' and em.em_approval_date <= '2005-02-06' group by em.em_proj_id union select pcd.proj_Id as proj_id, 'Cost' as AmtType, sum(pcd.percentage * pcm.totalvalue * pcm.exchangerate)/100 as CurrAmt sum(case when pcm.approvalDate <= '2005-01-30' then pcd.percentage * pcm.totalvalue * pcm.exchangerate else 0 end)/100 as LastAmt from proj_cost_det as pcd inner join proj_cost_mstr as pcm on pcd.costcode = pcm.costcode inner join Proj_Cost_Type as pct on pct.typeid=pcm.type inner join proj_mstr as proj on pcd.proj_Id = proj.proj_id inner join user_login as ul on proj.proj_pm_user = ul.user_login_id where ul.user_login_id ='CN01092' and pcm.claimtype='CN' and pct.typeaccount ='Expense' and pcm.approvalDate <= '2005-02-06' group by pcd.proj_Id union select ctc.ctc_proj_id as proj_id, 'CTC' as AmtType ,sum(case ctc.ctc_fm_ver = 4.0 when then ctc_amt else 0 end) as CurrAmt ,sum(case ctc.ctc_fm_ver = 3.0 when then ctc_amt else 0 end) as LastAmt from Proj_CTC as ctc inner join proj_mstr as proj on ctc.ctc_proj_id = proj.proj_id inner join user_login as ul on proj.proj_pm_user = ul.user_login_id where ul.user_login_id ='CN01092' and ctc.ctc_fm_ver in (4.0,3.0) group by ctc.ctc_proj_id ) as res on proj.proj_id = res.proj_id group by ul.user_login_id, ul.name, proj.proj_id, proj.proj_name